<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//ibatis.apache.org//DTD iBatis Mapper 3.0 //EN" "http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">
<mapper namespace="gob.dp.simco.registro.dao.ActorHistorialDao">
    
    <resultMap id="actorHistorialMap" type="actorHistorial">
        <id property="id" column="N_ID_HIST_ACTO" />
        <result property="idActor" column="N_ID_ACTO"/>
        <result property="accion" column="C_VALORMAESTROACTO"/>
        <result property="fechaRegistro" column="D_FECREGISTROACTO"/>
        <result property="usuarioRegistro" column="C_USERREGISTROACTO"/>
        <result property="entidad" column="C_ENTIDADACTO"/>
        <result property="idEntidad" column="N_IDENTIDADACTO"/>
        
    </resultMap>  

    <sql id="sqlBuscarActorHistorial">
        SELECT 
        A.N_ID_HIST_ACTO,
        A.N_ID_ACTO,
        A.C_VALORMAESTROACTO,
        A.D_FECREGISTROACTO,
        A.C_USERREGISTROACTO,
        A.C_ENTIDADACTO,
        A.N_IDENTIDADACTO
        FROM SIMCO_HIST_ACTOR A
        INNER JOIN
        SIMCO_HIST_MAESTRO B ON A.C_VALORMAESTROACTO = B.C_VALORMAESTRO
        AND B.N_PADREMAESTRO = 10    
    WHERE
        A.N_ID_ACTO=#{idActo}
    </sql>
    
    <select id="actorHistorialBuscarList" resultMap="actorHistorialMap" parameterType="actorHistorial">
	<include refid="sqlBuscarActorHistorial"/>
</select>   

    <insert id="actorHistorialInsertar" parameterType="actorHistorial">
        INSERT INTO SIMCO_HIST_ACTOR 
        (
        N_ID_HIST_ACTO,
        N_ID_ACTO,
        C_VALORMAESTROACTO,
        D_FECREGISTROACTO,
        <if test="entidad != null">
            C_ENTIDADACTO,
        </if>
        <if test="idEntidad != null">
            N_IDENTIDADACTO,
        </if>
        C_USERREGISTROACTO    
        )
        VALUES 
        (
        SEQ_SIMCO_HIST_ACTOR.NextVal,
        #{idActor},
        #{accion},
        #{fechaRegistro},
        <if test="entidad != null">
            #{entidad},
        </if>
        <if test="idEntidad != null">
            #{idEntidad},
        </if>
        #{usuarioRegistro}    
        )
    
        <selectKey keyProperty="id" resultType="Long">
            SELECT SEQ_SIMCO_HIST_ACTOR.CURRVAL FROM DUAL
        </selectKey>
    </insert>

</mapper>